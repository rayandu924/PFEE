<!DOCTYPE html>
<html>
<head>
    <title>WebRTC Client</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background-color: #f0f0f0;
        }
        video {
            width: 320px;
            height: 240px;
            background-color: #000;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h1>WebRTC Client</h1>
    <video id="video" autoplay playsinline controls></video>

    <script>
        async function start() {
            const pc = new RTCPeerConnection();

            // Handle incoming tracks
            pc.ontrack = function(event) {
                const stream = event.streams[0];
                const video = document.getElementById('video');
                video.srcObject = stream;
                console.log("Received video track");
            };

            // Create an offer with the expectation to receive video
            const offer = await pc.createOffer({
                offerToReceiveVideo: true
            });
            await pc.setLocalDescription(offer);
            console.log("Created and set local SDP offer");

            // Send the offer to the server via /offer endpoint
            const response = await fetch('/offer', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    sdp: pc.localDescription.sdp,
                    type: pc.localDescription.type
                })
            });

            if (!response.ok) {
                const error = await response.text();
                console.error("Failed to receive SDP answer:", error);
                return;
            }

            const answer = await response.json();
            const remoteDesc = new RTCSessionDescription(answer);
            await pc.setRemoteDescription(remoteDesc);
            console.log("Received and set remote SDP answer");
        }

        start().catch(err => {
            console.error("Error during WebRTC setup:", err);
        });
    </script>
</body>
</html>
